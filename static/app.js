const data = [
    {
        "Year": 2021,
        "Broker Name": "Miller ",
        "Gross Written Premium (GWP)": 528491.5776951652,
        "Planned GWP": 792737.3665427477,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Howden",
        "Gross Written Premium (GWP)": 181322.50749891822,
        "Planned GWP": 271983.7612483773,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Aon ",
        "Gross Written Premium (GWP)": 84163.92827121721,
        "Planned GWP": 126245.89240682582,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Besso",
        "Gross Written Premium (GWP)": 81961.47384816721,
        "Planned GWP": 122942.21077225081,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Croton Stokes",
        "Gross Written Premium (GWP)": 988720.6725250357,
        "Planned GWP": 1483081.0087875535,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Balance",
        "Gross Written Premium (GWP)": 492444.454405121,
        "Planned GWP": 738666.6816076814,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "BMS",
        "Gross Written Premium (GWP)": 322499.638132136,
        "Planned GWP": 483749.457198204,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "JLT ",
        "Gross Written Premium (GWP)": 335889.4383375997,
        "Planned GWP": 503834.15750639956,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Willis",
        "Gross Written Premium (GWP)": 227841.53192858957,
        "Planned GWP": 341762.29789288435,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Aon ",
        "Gross Written Premium (GWP)": 820441.132500566,
        "Planned GWP": 1230661.6987508489,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Miller ",
        "Gross Written Premium (GWP)": 121473.87111731089,
        "Planned GWP": 182210.80667596633,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Balance",
        "Gross Written Premium (GWP)": 703405.8871774407,
        "Planned GWP": 1055108.830766161,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "BMS",
        "Gross Written Premium (GWP)": 971255.374723917,
        "Planned GWP": 1456883.0620858755,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Convex",
        "Gross Written Premium (GWP)": 79609.1479216312,
        "Planned GWP": 119413.7218824468,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Tysers",
        "Gross Written Premium (GWP)": 177177.89238770644,
        "Planned GWP": 265766.83858155966,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "McGill",
        "Gross Written Premium (GWP)": 872954.7096580191,
        "Planned GWP": 1309432.0644870286,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Marsh",
        "Gross Written Premium (GWP)": 120539.93937121432,
        "Planned GWP": 180809.9090568215,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Gallagher",
        "Gross Written Premium (GWP)": 108111.4883294968,
        "Planned GWP": 162167.2324942452,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Kentro",
        "Gross Written Premium (GWP)": 760445.0795943625,
        "Planned GWP": 1140667.6193915438,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Hendersons",
        "Gross Written Premium (GWP)": 810428.7893591184,
        "Planned GWP": 1215643.1840386777,
        "Market Type": "Facilities"
    },
    {
        "Year": 2021,
        "Broker Name": "Gallagher",
        "Gross Written Premium (GWP)": 540784.5368410553,
        "Planned GWP": 811176.8052615828,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Hendersons",
        "Gross Written Premium (GWP)": 405770.5522586832,
        "Planned GWP": 608655.8283880248,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Kentro",
        "Gross Written Premium (GWP)": 96860.17904758116,
        "Planned GWP": 145290.26857137174,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Convex",
        "Gross Written Premium (GWP)": 99861.56797281854,
        "Planned GWP": 149792.35195922782,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Tysers",
        "Gross Written Premium (GWP)": 240378.8173325887,
        "Planned GWP": 360568.225998883,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "McGill",
        "Gross Written Premium (GWP)": 673146.5883161423,
        "Planned GWP": 1009719.8824742135,
        "Market Type": "Open Market"
    },
    {
        "Year": 2021,
        "Broker Name": "Marsh",
        "Gross Written Premium (GWP)": 838710.3448602626,
        "Planned GWP": 1258065.5172903938,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Miller ",
        "Gross Written Premium (GWP)": 255148.3672566799,
        "Planned GWP": 382722.5508850198,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Howden",
        "Gross Written Premium (GWP)": 985050.289680461,
        "Planned GWP": 1477575.4345206916,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Aon ",
        "Gross Written Premium (GWP)": 794263.139961792,
        "Planned GWP": 1191394.709942688,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Besso",
        "Gross Written Premium (GWP)": 704360.7992450028,
        "Planned GWP": 1056541.1988675043,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Croton Stokes",
        "Gross Written Premium (GWP)": 279452.72748740413,
        "Planned GWP": 419179.0912311062,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Balance",
        "Gross Written Premium (GWP)": 15948.38588846803,
        "Planned GWP": 23922.578832702045,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "BMS",
        "Gross Written Premium (GWP)": 8139.847270770772,
        "Planned GWP": 12209.770906156158,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "JLT ",
        "Gross Written Premium (GWP)": 804270.8117112366,
        "Planned GWP": 1206406.2175668548,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Willis",
        "Gross Written Premium (GWP)": 400479.22594311845,
        "Planned GWP": 600718.8389146777,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Aon ",
        "Gross Written Premium (GWP)": 590964.5555268383,
        "Planned GWP": 886446.8332902575,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Miller ",
        "Gross Written Premium (GWP)": 520522.5829992144,
        "Planned GWP": 780783.8744988216,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Balance",
        "Gross Written Premium (GWP)": 818040.2356305509,
        "Planned GWP": 1227060.3534458263,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "BMS",
        "Gross Written Premium (GWP)": 700721.6978318465,
        "Planned GWP": 1051082.5467477697,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Convex",
        "Gross Written Premium (GWP)": 579046.2041116927,
        "Planned GWP": 868569.3061675391,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Tysers",
        "Gross Written Premium (GWP)": 261495.66550867187,
        "Planned GWP": 392243.4982630078,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "McGill",
        "Gross Written Premium (GWP)": 670246.5034067106,
        "Planned GWP": 1005369.7551100659,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Marsh",
        "Gross Written Premium (GWP)": 497828.9079546526,
        "Planned GWP": 746743.361931979,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Gallagher",
        "Gross Written Premium (GWP)": 573310.2748004848,
        "Planned GWP": 859965.4122007272,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Kentro",
        "Gross Written Premium (GWP)": 405060.60797772504,
        "Planned GWP": 607590.9119665875,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Hendersons",
        "Gross Written Premium (GWP)": 64439.62016113214,
        "Planned GWP": 96659.43024169821,
        "Market Type": "Facilities"
    },
    {
        "Year": 2022,
        "Broker Name": "Gallagher",
        "Gross Written Premium (GWP)": 115333.52736952418,
        "Planned GWP": 173000.29105428627,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Hendersons",
        "Gross Written Premium (GWP)": 501300.8189804801,
        "Planned GWP": 751951.2284707201,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Kentro",
        "Gross Written Premium (GWP)": 997785.3564424538,
        "Planned GWP": 1496678.0346636807,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Convex",
        "Gross Written Premium (GWP)": 831935.5455677708,
        "Planned GWP": 1247903.3183516562,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Tysers",
        "Gross Written Premium (GWP)": 912122.6380877577,
        "Planned GWP": 1368183.9571316366,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "McGill",
        "Gross Written Premium (GWP)": 575548.7144837597,
        "Planned GWP": 863323.0717256395,
        "Market Type": "Open Market"
    },
    {
        "Year": 2022,
        "Broker Name": "Marsh",
        "Gross Written Premium (GWP)": 191502.18266940332,
        "Planned GWP": 287253.274004105,
        "Market Type": "Open Market"
    }
]

function calculateDifference(actualGWP, plannedGWP) {
    return ((actualGWP - plannedGWP) / plannedGWP * 100).toFixed(2);
}
let brokerChart;
function populateTable(marketType, year) {
    const tableBody = document.getElementById('broker-data-body');
    let filteredData = data.filter(entry => entry['Year'] == year);
    console.log(marketType);
    console.log(year);
    console.log(filteredData);
    if (marketType !== "Combined") {
        filteredData = filteredData.filter(entry => entry['Market Type'] === marketType);
    }
    filteredData.sort((a, b) => b['Gross Written Premium (GWP)'] - a['Gross Written Premium (GWP)']);
    tableBody.innerHTML = '';
    filteredData.slice(0, 10).forEach(entry => {
        const row = document.createElement('tr');
        const difference = calculateDifference(entry['Gross Written Premium (GWP)'], entry['Planned GWP']);
        row.innerHTML = `
            <td>${entry['Broker Name']}</td>
            <td>${entry['Gross Written Premium (GWP)']}</td>
            <td>${entry['Planned GWP']}</td>
            <td>${difference}%</td>
        `;
        tableBody.appendChild(row);
    });
    const top10 = filteredData.slice(0, 10);
    const label = top10.map(entry => entry['Broker Name']);
    const Data = top10.map(entry => entry['Gross Written Premium (GWP)']);
    const ctx = document.getElementById('broker-chart').getContext('2d');
    if (brokerChart) {
        brokerChart.destroy();
    }
    brokerChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: label,
            datasets: [{
                data: Data,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(54, 162, 235, 0.7)',
                    'rgba(255, 206, 86, 0.7)',
                    'rgba(75, 192, 192, 0.7)',
                    'rgba(153, 102, 255, 0.7)',
                    'rgba(255, 159, 64, 0.7)',
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(54, 162, 235, 0.7)',
                    'rgba(255, 206, 86, 0.7)',
                    'rgba(75, 192, 192, 0.7)'
                ],
                borderWidth: 3
            }]
        },
        options: {
            title: {
                display: true,
                text: `Top 10 Brokers - ${marketType}`,
                fontSize: 18
            },
            plugins : {
                legend : {
                    align: "center",
                    labels:{
                        font:{
                            color: "black",
                            size : 15,
                            weight :200
                        }
                    }
                }
            },
            radius : 250
        }
    });
}
document.getElementById('year-select').addEventListener('change', function () {
    console.log("Year changed");
    const year = this.value;
    const category = document.getElementById('category-select').value;
    populateTable(category, year);
    populatePieChart(category);
}
);
document.getElementById('category-select').addEventListener('change', function () {
    console.log("Category changed");
    const category = this.value;
    const year = document.getElementById('year-select').value;
    populateTable(category, year);
}
);
populateTable('Combined', 2021);

var classLabels = ['Crime', 'D&O', 'FIPI', 'PI'];
const jsonData = [
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 3394740.538493088,
        "Earned Premium": 997432.6375029628,
        "Gross Written Premium (GWP)": 1296662.4287538517
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 3176908.715258184,
        "Earned Premium": 286414.62765585625,
        "Gross Written Premium (GWP)": 372339.01595261315
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 753793.6929213679,
        "Earned Premium": 20312.954974952558,
        "Gross Written Premium (GWP)": 26406.841467438328
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 1233885.6762074828,
        "Earned Premium": 963999.5055850594,
        "Gross Written Premium (GWP)": 1253199.3572605774
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 4274607.185349996,
        "Earned Premium": 181601.73898833475,
        "Gross Written Premium (GWP)": 236082.26068483517
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 2763863.1508424305,
        "Earned Premium": 554720.0057703408,
        "Gross Written Premium (GWP)": 721136.007501443
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 547029.665562696,
        "Earned Premium": 113393.69918019482,
        "Gross Written Premium (GWP)": 147411.80893425326
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 3427263.2446700046,
        "Earned Premium": 781318.3587780262,
        "Gross Written Premium (GWP)": 1015713.866411434
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 2027758.9704323935,
        "Earned Premium": 323575.2153412215,
        "Gross Written Premium (GWP)": 420647.77994358796
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 97834.10102904621,
        "Earned Premium": 337039.6007094646,
        "Gross Written Premium (GWP)": 438151.480922304
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 220407.05250742365,
        "Earned Premium": 803516.256172513,
        "Gross Written Premium (GWP)": 1044571.1330242669
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 1859326.5379302304,
        "Earned Premium": 689803.013160462,
        "Gross Written Premium (GWP)": 896743.9171086006
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 2803087.8013575138,
        "Earned Premium": 46883.356508698125,
        "Gross Written Premium (GWP)": 60948.36346130756
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 2697379.1637767926,
        "Earned Premium": 606218.5321802242,
        "Gross Written Premium (GWP)": 788084.0918342915
    },
    {
        "Year": 2021,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 4946600.814763016,
        "Earned Premium": 309119.54821530887,
        "Gross Written Premium (GWP)": 401855.4126799015
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 1733388.2672228785,
        "Earned Premium": 377211.3264137673,
        "Gross Written Premium (GWP)": 490374.7243378975
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 3000810.921019772,
        "Earned Premium": 637997.0465344714,
        "Gross Written Premium (GWP)": 829396.1604948129
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 1551107.927191776,
        "Earned Premium": 283450.3527484331,
        "Gross Written Premium (GWP)": 368485.4585729631
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 2335508.5236889445,
        "Earned Premium": 235217.03311367703,
        "Gross Written Premium (GWP)": 305782.14304778015
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 2457146.2999347937,
        "Earned Premium": 212851.55135537504,
        "Gross Written Premium (GWP)": 276707.0167619875
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 216132.07268118995,
        "Earned Premium": 503652.8413402256,
        "Gross Written Premium (GWP)": 654748.6937422933
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 2420383.450914114,
        "Earned Premium": 477959.4038408961,
        "Gross Written Premium (GWP)": 621347.2249931649
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 4410724.256221647,
        "Earned Premium": 657028.7482743702,
        "Gross Written Premium (GWP)": 854137.3727566813
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 2027744.9473760328,
        "Earned Premium": 675686.5665542864,
        "Gross Written Premium (GWP)": 878392.5365205724
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 3647361.7841483806,
        "Earned Premium": 594016.4463494924,
        "Gross Written Premium (GWP)": 772221.3802543401
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 2213853.223044541,
        "Earned Premium": 391492.28420291224,
        "Gross Written Premium (GWP)": 508939.96946378594
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 2215646.5066392054,
        "Earned Premium": 839810.0378366093,
        "Gross Written Premium (GWP)": 1091753.0491875922
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 3116709.8974756924,
        "Earned Premium": 69643.45175447407,
        "Gross Written Premium (GWP)": 90536.48728081629
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 1226781.0911191767,
        "Earned Premium": 926340.5575723279,
        "Gross Written Premium (GWP)": 1204242.7248440264
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 728337.3348176947,
        "Earned Premium": 91424.80993352398,
        "Gross Written Premium (GWP)": 118852.25291358118
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 1155300.1933853773,
        "Earned Premium": 688569.6265289157,
        "Gross Written Premium (GWP)": 895140.5144875904
    },
    {
        "Year": 2021,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 901923.0234223213,
        "Earned Premium": 732524.6510042786,
        "Gross Written Premium (GWP)": 952282.0463055621
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 477836.4515819926,
        "Earned Premium": 604960.7696804894,
        "Gross Written Premium (GWP)": 621187.3870565904
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 744666.0962047941,
        "Earned Premium": 456007.0397583611,
        "Gross Written Premium (GWP)": 968065.9250662324
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 535142.9244031777,
        "Earned Premium": 350677.20573595795,
        "Gross Written Premium (GWP)": 695685.801724131
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 266430.065263495,
        "Earned Premium": 265855.5434998423,
        "Gross Written Premium (GWP)": 346359.0848425435
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 545661.3546514637,
        "Earned Premium": 704724.8466867829,
        "Gross Written Premium (GWP)": 709359.7610469029
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 70096.50936532664,
        "Earned Premium": 463656.67132015264,
        "Gross Written Premium (GWP)": 91125.46217492463
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 614612.7692021556,
        "Earned Premium": 93895.28344075326,
        "Gross Written Premium (GWP)": 798996.5999628024
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 575902.4766394311,
        "Earned Premium": 671803.7805148897,
        "Gross Written Premium (GWP)": 748673.2196312605
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 284195.35950719786,
        "Earned Premium": 182718.62111985672,
        "Gross Written Premium (GWP)": 369453.9673593572
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 382157.5608468843,
        "Earned Premium": 937772.5012636407,
        "Gross Written Premium (GWP)": 496804.82910094963
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 585380.3440569642,
        "Earned Premium": 533443.6645050669,
        "Gross Written Premium (GWP)": 760994.4472740535
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 434168.87127933203,
        "Earned Premium": 299000.7212385366,
        "Gross Written Premium (GWP)": 564419.5326631317
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "Crime",
        "Business Plan": 698735.2802050569,
        "Earned Premium": 322340.4979866502,
        "Gross Written Premium (GWP)": 908355.864266574
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "FIPI",
        "Business Plan": 101694.89721390835,
        "Earned Premium": 67275.74969329264,
        "Gross Written Premium (GWP)": 132203.36637808086
    },
    {
        "Year": 2022,
        "Class of Business": "Financial Institution",
        "ClassType": "D&O",
        "Business Plan": 890531.8728565492,
        "Earned Premium": 611877.9091200008,
        "Gross Written Premium (GWP)": 1157691.434713514
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 393735.95990284317,
        "Earned Premium": 50606.62601598176,
        "Gross Written Premium (GWP)": 511856.74787369615
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 26154.518014143257,
        "Earned Premium": 201318.13273844734,
        "Gross Written Premium (GWP)": 34000.87341838623
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 880533.9785942531,
        "Earned Premium": 391246.44510105654,
        "Gross Written Premium (GWP)": 1144694.172172529
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 419011.092002196,
        "Earned Premium": 816783.6663381407,
        "Gross Written Premium (GWP)": 544714.4196028549
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 144534.99907180923,
        "Earned Premium": 330032.456784876,
        "Gross Written Premium (GWP)": 187895.49879335202
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 906945.4255152397,
        "Earned Premium": 778405.718177872,
        "Gross Written Premium (GWP)": 1179029.0531698116
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 450145.469535164,
        "Earned Premium": 260897.02950613026,
        "Gross Written Premium (GWP)": 585189.1103957132
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 904679.0357134332,
        "Earned Premium": 313715.10176202934,
        "Gross Written Premium (GWP)": 1176082.7464274631
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 629789.2901980655,
        "Earned Premium": 643564.8722012594,
        "Gross Written Premium (GWP)": 818726.0772574851
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 119250.56096473319,
        "Earned Premium": 280733.5825454005,
        "Gross Written Premium (GWP)": 155025.72925415315
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 768374.458785354,
        "Earned Premium": 598304.4615586944,
        "Gross Written Premium (GWP)": 998886.7964209603
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 400843.69258841436,
        "Earned Premium": 756721.4661549819,
        "Gross Written Premium (GWP)": 521096.8003649387
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 609807.2186091961,
        "Earned Premium": 472576.3269658719,
        "Gross Written Premium (GWP)": 792749.384191955
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 384930.620894294,
        "Earned Premium": 513460.0861945681,
        "Gross Written Premium (GWP)": 500409.80716258223
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 239681.2126677038,
        "Earned Premium": 506541.9519307717,
        "Gross Written Premium (GWP)": 311585.576468015
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 446796.50025153096,
        "Earned Premium": 942127.8010431506,
        "Gross Written Premium (GWP)": 580835.4503269902
    },
    {
        "Year": 2022,
        "Class of Business": "Commercial PI",
        "ClassType": "PI",
        "Business Plan": 140456.5129357951,
        "Earned Premium": 952096.6829892646,
        "Gross Written Premium (GWP)": 182593.46681653362
    }
];

function populateTable2(businessType, classType) {
    const tableBody = document.getElementById('metrics-data-body');
    tableBody.innerHTML = '';
    const anotherData = jsonData.filter(entry => entry['Class of Business'] == businessType);
    const filteredData = classType === 'All' ? anotherData : anotherData.filter(entry => entry['ClassType'] === classType);
    filteredData.forEach(entry => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${entry['Class of Business']}</td>
            <td>${entry['ClassType']}</td>
            <td>${entry['Business Plan']}</td>
            <td>${entry['Earned Premium']}</td>
            <td>${entry['Gross Written Premium (GWP)']}</td>
        `;
        tableBody.appendChild(row);
    });
}
document.getElementById('business-type-select').addEventListener('change', function () {
    const business_class = this.value;
    const classType = document.getElementById('class-type-select');
    classType.value = 'All';
    populateTable2(business_class, 'All');
});
document.getElementById('class-type-select').addEventListener('change', function () {
    const business_class = document.getElementById('business-type-select').value;
    const classType = this.value;
    populateTable2(business_class, classType);
});
populateTable2('Financial Institution', 'All');

class Chatbox {
    constructor() {
        this.args = {
            openButton: document.querySelector('.chatbox__button'),
            chatBox: document.querySelector('.chatbox__support'),
            sendButton: document.querySelector('.send__button')
        };
        this.state = false;
        this.messages = [];
    }    

    display() {
        const {openButton, chatBox, sendButton} = this.args;
        openButton.addEventListener('click', this.toggleState(chatBox));

        sendButton.addEventListener('click', this.onSendButton(chatBox));

        const node = chatBox.querySelector('input');
        node.addEventListener('keyup', (key) => {
            if(key === "Enter") {
                this.onSendButton(chatBox);
            }
        });
    }

    toggleState(chatBox) {
        this.state = !this.state;
        if(this.state) {
            chatBox.classList.add('chatbox--active');
        } else {
            chatBox.classList.remove('chatbox--active');
        }
    }

    onSendButton(chatBox) {
        var textField = chatBox.querySelector('input');
        let text1 = textField.value;
        if(text1 === "")
            return;

        let msg = {name : "User", message : text1};
        this.messages.push(msg);
        this.messages.push(msg);
        console.log(msg);
        // 'http://127.0.0.1:5000/predict'
        fetch($SCRIPT_ROOT + '/predict', {
            method: 'POST',
            body: JSON.stringify({message: text1}),
            mode: 'core',
            headers: {
                'Content-Type': 'application/json'
            },
        })
        .then(r => r.json())
        .then(r => {
            let msg2 = { name: "Matilda", message: r.answer};
            this.messages.push(msg2);
            this.updateChatText(chatbox);
            textField.value = '';
        }).catch((error) => {
            console.error('Error: ', error);
            this.updateChatText(chatBox);
            textField.value = '';
        });
    }

    updateChatText(chatBox) {
        var html = '';
        this.messages.slice(),reverse(),forEach(function(item,) {
            if(item.name === "Matilda") {
                html += '<div class = "messages__item messages__item--visitor">' + item.message + '</div>';
            }   else {
                html += '<div class = "messages__item messages__item--operator">' + item.message + '</div>';
            }
        });

        const chatMessage = chatBox.querySelector('.chatbox__messages');
        chatMessage.innerHTML = html;
    }
}

const chatBox = new Chatbox();
chatBox.display();










// function fetchJSONData() {

//     fetch('/Dashboard_Data2.json')
//         .then((res) => {
//             if (!res.ok) {
//                 throw new Error
//                     (`HTTP error! Status: ${res.status}`);
//             }
//             return res.json();
//         })
//         .then(
//             data => {
//                 const openMarketData = filterByMarketType(data, 'Open Market');
//                 const facilitiesData = filterByMarketType(data, 'Facilities');
//                 populateTable(openMarketData);
//                 populateTable(facilitiesData);
//             }
//         )
//         .catch((error) =>
//             console.error("Unable to fetch data:", error));
// }
// fetchJSONData();
// Fetch data from JSON file
// fetch('/Dashboard_Data2.json')
//     .then(response => response.json())
//     .then(data => {
//         const openMarketData = filterByMarketType(data, 'Open Market');
//         const facilitiesData = filterByMarketType(data, 'Facilities');
//         populateTable(openMarketData);
//         populateTable(facilitiesData);
//     })
//     .catch(error => console.error('Error fetching data:', error));
// Function to render broker chart
// function renderBrokerChart(data) {
//     const brokers = data.map(entry => entry.broker);
//     const gwpOpenMarket = data.map(entry => entry.gwp_open_market);
//     const gwpFacilities = data.map(entry => entry.gwp_facilities);
//     const gwpCombined = data.map(entry => entry.gwp_combined);

//     const ctx = document.getElementById('broker-chart').getContext('2d');
//     new Chart(ctx, {
//         type: 'bar',
//         data: {
//             labels: brokers,
//             datasets: [
//                 { label: 'GWP Open Market', data: gwpOpenMarket, backgroundColor: 'rgba(255, 99, 132, 0.2)' },
//                 { label: 'GWP Facilities', data: gwpFacilities, backgroundColor: 'rgba(54, 162, 235, 0.2)' },
//                 { label: 'GWP Combined', data: gwpCombined, backgroundColor: 'rgba(255, 206, 86, 0.2)' }
//             ]
//         },
//         options: {
//             scales: {
//                 yAxes: [{ ticks: { beginAtZero: true } }]
//             }
//         }
//     });
// }

// // Function to populate business analysis table
// function populateBusinessAnalysisTable(data) {
//     const table = document.getElementById('business-analysis-table');
//     let html = `<tr><th>Business Class</th><th>Planned Premium</th><th>Earned Premium</th><th>GWP</th></tr>`;

//     // For demonstration purposes, let's assume we have static data
//     const businessClasses = ['Class A', 'Class B', 'Class C'];
//     businessClasses.forEach(businessClass => {
//         html += `<tr><td>${businessClass}</td><td>10000</td><td>8000</td><td>12000</td></tr>`;
//     });

//     table.innerHTML = html;
// }

// // Function to populate year filter
// function populateYearFilter(data) {
//     const years = ['2022', '2023', '2024']; // Extract unique years from data
//     const select = document.getElementById('year-select');

//     years.forEach(year => {
//         const option = document.createElement('option');
//         option.text = year;
//         option.value = year;
//         select.add(option);
//     });
// }

// // Event listener for year filter change
// document.getElementById('year-select').addEventListener('change', function () {
//     // Code to update dashboard visuals based on selected year
//     // For demonstration purposes, you can reload the data based on the selected year and re-render the dashboard components
// });

// // Main function to initialize dashboard
// function initDashboard() {
//     // Fetch data from Excel sheet
//     const data = fetchDataFromExcel();

//     // Populate dashboard components
//     populateTopBrokersTable(data);
//     renderBrokerChart(data);
//     populateBusinessAnalysisTable(data);
//     populateYearFilter(data);
// }

// // Call initDashboard function when the page is loaded
// window.onload = initDashboard;
